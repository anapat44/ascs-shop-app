<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASCS Souvenir Shop | ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏•‡∏∂‡∏Å</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Custom styles and fonts */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
        }
        .container-app {
            max-width: 1200px;
            margin: auto;
            min-height: 100vh;
            padding: 1rem;
        }
        /* Custom scrollbar for cart item list */
        .cart-item-list { 
            max-height: 250px; 
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #facc15 #e5e7eb;
        }
        .cart-item-list::-webkit-scrollbar {
            width: 8px;
        }
        .cart-item-list::-webkit-scrollbar-thumb {
            background-color: #facc15;
            border-radius: 10px;
        }
        /* Style for number input controls */
        .number-input-control {
            appearance: none;
            -moz-appearance: textfield;
        }
        .number-input-control::-webkit-outer-spin-button,
        .number-input-control::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        /* Custom style to make embedded iframes (like Flickr's) responsive within their container */
        .product-image-container {
            width: 100%;
            /* ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÇ‡∏î‡∏¢ JavaScript ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡πÅ‡∏ñ‡∏ß */
            height: 100%; 
            /* Ensure the content inside fits and centers */
            display: flex;
            align-items: center;
            justify-content: center;
        }
        /* [FIX 1/2] - CSS: ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ container ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ï‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡πÑ‡∏î‡πâ */
        .product-img-box {
            height: auto; 
            min-height: 150px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏° min-height ‡πÄ‡∏õ‡πá‡∏ô Fallback ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÑ‡∏°‡πà‡πÇ‡∏´‡∏•‡∏î */
        }
        
        .product-image-container iframe {
            /* ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡πÉ‡∏´‡πâ iframe ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏†‡∏≤‡∏¢‡πÉ‡∏ô ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á container */
            max-width: 100% !important;
            max-height: 100% !important;
            /* ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡πÉ‡∏´‡πâ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏†‡∏≤‡∏¢‡πÉ‡∏ô iframe ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡πÇ‡∏î‡∏¢‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô */
            object-fit: contain; 
            
            /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà parent ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ max/min ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏î‡∏µ */
            width: 100%; 
            height: 100%; 

            border: none !important; /* Remove any default border */
        }
        /* Style to handle potential height/width attributes in embed code */
        .product-image-container iframe[width], 
        .product-image-container iframe[height] {
            width: 100% !important;
            height: 100% !important;
        }
    </style>
</head>
<body class="bg-gray-50">

    <div id="loading-overlay" class="fixed inset-0 bg-white bg-opacity-80 flex items-center justify-center z-50 hidden">
        <div class="flex flex-col items-center">
            <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-yellow-500"></div>
            <p class="mt-4 text-gray-700 font-semibold">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
        </div>
    </div>

    <div id="message-box" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full">
            <h3 id="message-title" class="text-xl font-bold mb-3 text-red-600">‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</h3>
            <p id="message-text" class="text-gray-700"></p>
            <button onclick="hideMessageBox()" class="mt-5 w-full py-2 bg-yellow-500 text-white font-bold rounded-lg hover:bg-yellow-600 transition duration-150">‡∏ï‡∏Å‡∏•‡∏á</button>
        </div>
    </div>

    <div class="container-app">
        
        <header id="custom-app-header" class="mb-6 p-6 bg-red-700 text-white text-center shadow-lg">
            <h1 class="text-3xl font-bold">‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏•‡∏∂‡∏Å ASCS</h1>
            <p class="text-sm mt-1 opacity-90">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏•‡∏∂‡∏Å</p>
        </header>

        <main id="app-content">
            
            <div class="flex justify-center items-center py-4 bg-white rounded-xl shadow-lg mb-6">
                <div id="step-1" class="flex flex-col items-center mx-2 sm:mx-4 opacity-50">
                    <div class="w-8 h-8 sm:w-10 sm:h-10 rounded-full bg-gray-200 text-gray-500 flex items-center justify-center font-bold">1</div>
                    <span class="text-xs sm:text-sm mt-1 text-gray-500">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span>
                </div>
                <div class="w-8 sm:w-12 h-0.5 bg-gray-300"></div>
                <div id="step-2" class="flex flex-col items-center mx-2 sm:mx-4 opacity-50">
                    <div class="w-8 h-8 sm:w-10 sm:h-10 rounded-full bg-gray-200 text-gray-500 flex items-center justify-center font-bold">2</div>
                    <span class="text-xs sm:text-sm mt-1 text-gray-500">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                </div>
                <div class="w-8 sm:w-12 h-0.5 bg-gray-300"></div>
                <div id="step-3" class="flex flex-col items-center mx-2 sm:mx-4 opacity-50">
                    <div class="w-8 h-8 sm:w-10 sm:h-10 rounded-full bg-gray-200 text-gray-500 flex items-center justify-center font-bold">3</div>
                    <span class="text-xs sm:text-sm mt-1 text-gray-500">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</span>
                </div>
            </div>

            <header id="app-header" class="mb-6 p-4 bg-white rounded-xl shadow-lg flex flex-col md:flex-row items-center border-t-4 border-yellow-500">
                <div class="md:w-32 w-24 h-24 md:h-32 bg-gray-200 rounded-lg overflow-hidden flex-shrink-0 mb-4 md:mb-0 md:mr-6">
                    <div id="promo-image-embed" class="w-full h-full product-image-container p-1">
                        <div class="text-xs text-gray-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô...</div> 
                    </div>
                </div>
                <div class="flex-grow text-center md:text-left">
                    <p id="promo-line-1" class="text-yellow-600 font-bold text-lg"></p>
                    <p id="promo-line-2" class="text-gray-800 font-semibold md:text-2xl text-xl"></p>
                    <p id="promo-line-3" class="text-gray-600 text-sm"></p>
                </div>
            </header>

            <div id="view-products" class="view-stage">
                <h2 class="text-2xl font-bold text-gray-700 mb-4 border-b pb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏•‡∏∂‡∏Å</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="product-list">
                    </div>
                
                <div id="cart-summary-fixed" class="fixed bottom-0 left-0 right-0 bg-white border-t-2 border-yellow-500 p-4 shadow-2xl z-20 md:relative md:mt-6 md:p-0 md:shadow-none md:border-t-0 md:bg-transparent md:border md:rounded-xl md:shadow-lg">
                    
                    <div id="cart-header" class="flex justify-between items-center mb-3 cursor-pointer md:cursor-default" onclick="toggleCartList()">
                        <h3 class="text-lg md:text-xl font-bold text-gray-800 flex items-center">
                            ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
                            <svg id="cart-toggle-icon" class="md:hidden ml-2 transition-transform transform w-5 h-5 text-gray-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                        </h3>
                    </div>

                    <div id="cart-item-list" class="hidden md:block border-t pt-3 mt-3 space-y-2 cart-item-list border-gray-100">
                        <div class="text-gray-500 text-sm italic text-center p-2">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤</div>
                    </div>
                    
                    <div id="cart-promotion-message" class="mt-2">
                        </div>

                    <div id="cart-summary-total" class="flex justify-between items-center font-bold text-lg md:text-xl text-gray-800 mt-4 pt-3 border-t">
                        <span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span>
                        <span id="cart-total-display">0.00 ‡∏ö‡∏≤‡∏ó</span>
                    </div>

                    <button id="checkout-button" onclick="showView('student-info')" disabled class="w-full py-3 bg-gray-400 text-white font-bold rounded-lg transition duration-150 mt-4 cursor-not-allowed">
                        ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠ (‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á)
                    </button>
                </div>
            </div>

            <div id="view-student-info" class="view-stage hidden p-6 bg-white rounded-xl shadow-lg">
                <h2 class="text-2xl font-bold text-gray-700 mb-6 border-b pb-2">2. ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
                <form id="student-info-form" onsubmit="event.preventDefault(); validateStudentInfo()">
                    
                    <div class="space-y-4 mb-8">
                        <div>
                            <label for="studentName" class="block text-sm font-medium text-gray-700">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô*</label>
                            <input type="text" id="studentName" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-yellow-500 focus:ring-yellow-500 p-3 border" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏≠‡∏±‡∏™‡∏™‡∏±‡∏° ‡∏Ñ‡∏≠‡∏ô‡πÅ‡∏ß‡∏ô‡∏ï‡πå">
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="studentLevel" class="block text-sm font-medium text-gray-700">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô*</label>
                                <select id="studentLevel" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-yellow-500 focus:ring-yellow-500 p-3 border">
                                    <option value="" disabled selected>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</option>
                                    <option value="‡∏õ.1">‡∏õ.1</option>
                                    <option value="‡∏õ.2">‡∏õ.2</option>
                                    <option value="‡∏õ.3">‡∏õ.3</option>
                                    <option value="‡∏õ.4">‡∏õ.4</option>
                                    <option value="‡∏õ.5">‡∏õ.5</option>
                                    <option value="‡∏õ.6">‡∏õ.6</option>
                                </select>
                            </div>
                            <div>
                                <label for="contactPhone" class="block text-sm font-medium text-gray-700">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ*</label>
                                <input type="tel" id="contactPhone" required pattern="[0-9]{10}" title="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå 10 ‡∏´‡∏•‡∏±‡∏Å" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-yellow-500 focus:ring-yellow-500 p-3 border" placeholder="‡πÄ‡∏ä‡πà‡∏ô 0812345678">
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">‡∏´‡πâ‡∏≠‡∏á*</label>
                                <div class="flex mt-1">
                                    <button type="button" onclick="changeNumber('studentRoom', -1)" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-l-lg hover:bg-gray-300 transition duration-150">-</button>
                                    <input type="number" id="studentRoom" required min="1" value="1" class="number-input-control block w-full text-center border-y border-gray-300 shadow-sm focus:border-yellow-500 focus:ring-yellow-500 p-2.5">
                                    <button type="button" onclick="changeNumber('studentRoom', 1)" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-r-lg hover:bg-gray-300 transition duration-150">+</button>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà*</label>
                                <div class="flex mt-1">
                                    <button type="button" onclick="changeNumber('studentNumber', -1)" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-l-lg hover:bg-gray-300 transition duration-150">-</button>
                                    <input type="number" id="studentNumber" required min="1" value="1" class="number-input-control block w-full text-center border-y border-gray-300 shadow-sm focus:border-yellow-500 focus:ring-yellow-500 p-2.5">
                                    <button type="button" onclick="changeNumber('studentNumber', 1)" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-r-lg hover:bg-gray-300 transition duration-150">+</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex space-x-4">
                        <button type="button" onclick="showView('products')" class="w-1/2 py-3 border border-gray-300 text-gray-700 font-bold rounded-lg hover:bg-gray-100 transition duration-150">
                            ‚Üê ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö
                        </button>
                        <button type="submit" id="continue-summary-button" class="w-1/2 py-3 bg-yellow-500 text-white font-bold rounded-lg hover:bg-yellow-600 transition duration-150">
                            ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠
                        </button>
                    </div>
                </form>
            </div>

            <div id="view-summary-payment" class="view-stage hidden p-6 bg-white rounded-xl shadow-lg">
                <h2 class="text-2xl font-bold text-gray-700 mb-6 border-b pb-2">3. ‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h2>
                
                <div class="mb-6 border p-4 rounded-lg bg-gray-50">
                    <h3 class="text-xl font-semibold text-gray-700 mb-3 border-b pb-2">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h3>
                    <div class="space-y-1 text-gray-600 text-sm">
                        <p><strong>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•:</strong> <span id="summary-student-name"></span></p>
                        <p><strong>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô/‡∏´‡πâ‡∏≠‡∏á (‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà):</strong> <span id="summary-student-level-room-no"></span></p>
                        <p><strong>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå:</strong> <span id="summary-contact-phone"></span></p>
                    </div>
                    <button onclick="showView('student-info')" class="mt-3 text-yellow-600 text-sm hover:text-yellow-700 font-medium">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                </div>

                <div class="mb-6 border p-4 rounded-lg">
                    <h3 class="text-xl font-semibold text-gray-700 mb-3 border-b pb-2">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                    <div id="summary-cart-items" class="space-y-2 mb-4">
                        </div>
                    
                    <div id="summary-promotion-message" class="text-green-600 text-sm font-semibold p-2 bg-green-50 rounded-lg hidden">
                        </div>

                    <div class="flex justify-between items-center font-bold text-2xl text-gray-800 mt-4 pt-3 border-t-2 border-yellow-500">
                        <span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥:</span>
                        <span id="summary-total-display">0.00 ‡∏ö‡∏≤‡∏ó</span>
                    </div>
                    <button onclick="showView('products')" class="mt-3 text-yellow-600 text-sm hover:text-yellow-700 font-medium">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>
                </div>

                <div class="mb-8 p-4 rounded-lg border-2 border-dashed border-gray-300 bg-white shadow-inner">
                    <h3 class="text-xl font-semibold text-red-600 mb-4 border-b pb-2">‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h3>
                    <div class="flex justify-center items-center h-48 bg-white rounded-lg p-2 mb-4">
                        <div id="qr-code-embed-container" class="w-full h-full flex items-center justify-center">
                            <p class="text-gray-400 text-sm">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î QR Code ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô...</p>
                        </div>
                    </div>
                    <p class="text-center text-sm text-gray-600 mt-2">‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏¢‡∏≠‡∏î <span id="payment-amount" class="font-bold text-red-600"></span> ‡∏ö‡∏≤‡∏ó</p>
                </div>

                <div class="mb-8 border p-4 rounded-lg bg-yellow-50">
                    <h3 class="text-xl font-semibold text-gray-700 mb-4 border-b pb-2">‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô</h3>
                    <input type="file" id="payment-slip-file" accept="image/*,.pdf" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-yellow-100 file:text-yellow-700 hover:file:bg-yellow-200">
                </div>

                <div class="flex space-x-4">
                    <button type="button" onclick="showView('student-info')" class="w-1/2 py-3 border border-gray-300 text-gray-700 font-bold rounded-lg hover:bg-gray-100 transition duration-150">
                        ‚Üê ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö
                    </button>
                    <button id="submit-order-button" onclick="submitOrder()" class="w-1/2 py-3 bg-gray-400 text-white font-bold rounded-lg transition duration-150 cursor-not-allowed" disabled>
                        ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ
                    </button>
                </div>
            </div>

            <div id="view-success" class="view-stage hidden flex flex-col items-center justify-center p-8 bg-white rounded-xl shadow-2xl h-[50vh] text-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-green-500 mb-4" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                </svg>
                <h2 id="success-line-1" class="text-3xl font-bold text-green-600 mb-2">‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</h2>
                <p id="success-line-2" class="text-gray-700 text-lg mb-1">‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏•‡∏∂‡∏Å ASCS</p>
                <p id="success-line-3" class="text-gray-500 text-sm mb-4">‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 1-2 ‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£</p>
                <p id="success-transaction-no" class="text-gray-800 font-bold bg-yellow-100 p-2 rounded-lg"></p>
                <button onclick="resetApp()" class="mt-6 py-2 px-6 bg-yellow-500 text-white font-bold rounded-lg hover:bg-yellow-600 transition duration-150">
                    ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà
                </button>
            </div>

        </main>
    </div>

    <script>
        // --- CONFIGURATION ---
        // URL ‡∏Ç‡∏≠‡∏á Google Apps Script Web App (‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á)
        const GAS_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzz6XW95M6g77mR5gV0Hh0Q8J0qJ7X8Z6l4B3K7L/exec";
        const API_ENDPOINT_GET_DATA = GAS_WEB_APP_URL + "?action=getAppData";
        const API_ENDPOINT_SUBMIT_ORDER = GAS_WEB_APP_URL + "?action=submitOrder";
        const API_ENDPOINT_UPLOAD_SLIP = GAS_WEB_APP_URL + "?action=uploadSlip";

        // Global State
        let appData = null;
        let cart = [];
        let currentView = 'products';
        const views = ['products', 'student-info', 'summary-payment', 'success'];
        
        // --- HELPER FUNCTIONS ---

        function formatPrice(price) {
            return parseFloat(price).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        function toggleLoading(show) {
            document.getElementById('loading-overlay').classList.toggle('hidden', !show);
        }

        function showMessageBox(title, message) {
            document.getElementById('message-title').textContent = title;
            document.getElementById('message-text').textContent = message;
            document.getElementById('message-box').classList.remove('hidden');
        }

        function hideMessageBox() {
            document.getElementById('message-box').classList.add('hidden');
        }

        function changeNumber(id, delta) {
            const input = document.getElementById(id);
            let value = parseInt(input.value) || 0;
            const min = parseInt(input.min) || 0;
            value += delta;
            if (value < min) value = min;
            input.value = value;
        }

        function toggleCartList() {
            const list = document.getElementById('cart-item-list');
            const icon = document.getElementById('cart-toggle-icon');
            
            if (window.innerWidth < 768) {
                list.classList.toggle('hidden');
                icon.classList.toggle('rotate-180', !list.classList.contains('hidden'));
            }
        }

        // --- LAYOUT/HEIGHT MANAGEMENT (FIXED FOOTER OVERLAP FIX) ---

        // [FIX] ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏° Padding ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö Product View ‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠
        function setMobilePadding() {
            const productView = document.getElementById('view-products');
            const fixedCart = document.getElementById('cart-summary-fixed');
            
            // 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ (‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 768px - Tailwind 'md' breakpoint)
            if (window.innerWidth < 768) {
                if (fixedCart && productView) {
                    
                    // Note: ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏´‡πâ fixedCart ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏∂‡∏á‡∏à‡∏∞‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
                    const originalDisplay = fixedCart.style.display;
                    // Temporary show if it was hidden
                    fixedCart.style.display = 'block'; 
                    
                    const cartHeight = fixedCart.offsetHeight; 
                    
                    // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÄ‡∏î‡∏¥‡∏°
                    fixedCart.style.display = originalDisplay;

                    // 4. ‡∏Å‡∏≥‡∏´‡∏ô‡∏î padding-bottom ‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö Product View Container 
                    // ‡πÄ‡∏û‡∏¥‡πà‡∏° 16px (1rem) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ (buffer)
                    productView.style.paddingBottom = `${cartHeight + 16}px`;
                }
            } else {
                // ‡∏ö‡∏ô Desktop ‡πÉ‡∏´‡πâ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤ Padding
                if (productView) {
                    productView.style.paddingBottom = '0';
                }
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á Product Image Container ‡πÅ‡∏•‡∏∞‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏≠‡∏±‡∏ô
        function alignProductImageHeights() {
            const imageContainers = document.querySelectorAll('.product-img-box');
            if (imageContainers.length === 0) return;

            // Step 1: Measure Max Height in the current grid layout
            let maxHeight = 0;
            imageContainers.forEach(container => {
                // ‡πÉ‡∏´‡πâ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà
                container.style.height = 'auto'; 
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏ß‡∏¥‡∏ß‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
                if (container.offsetParent !== null) {
                    const currentHeight = container.offsetHeight;
                    if (currentHeight > maxHeight) {
                        maxHeight = currentHeight;
                    }
                }
            });

            // Step 2: Apply Max Height to all containers
            if (maxHeight > 0) {
                imageContainers.forEach(container => {
                    // ‡πÉ‡∏ä‡πâ inline style ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á (‡∏°‡∏µ priority ‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤ CSS class)
                    container.style.height = `${maxHeight}px`;
                });
            }
        }

        function waitForProductContentLoad() {
            const imageContainers = document.querySelectorAll('.product-image-container');
            if (imageContainers.length === 0) return Promise.resolve();

            const loadChecks = [];
            
            imageContainers.forEach(container => {
                // Search for img or iframe within the container
                const content = container.querySelector('img, iframe');
                if (content) {
                    // Create a promise that resolves when content loads or after a robust timeout
                    loadChecks.push(new Promise(resolve => {
                        let resolved = false;
                        const resolveLoad = () => {
                            if (!resolved) {
                                resolved = true;
                                resolve();
                            }
                        };
                        // 1. Check if already loaded (for cached images/fast browsers)
                        if (content.complete || (content.readyState === 'complete')) {
                            resolveLoad();
                            return;
                        }
                        // 2. Wait for load event
                        // ‡πÉ‡∏ä‡πâ addEventListener ‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ï‡∏£‡∏á‡πÜ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡∏°‡∏µ Listener ‡∏≠‡∏∑‡πà‡∏ô‡πÜ
                        content.addEventListener('load', resolveLoad, { once: true });
                        // 3. Fallback: Add a generous timeout (e.g. 2000ms) for mobile in case onload never fires/iframe is broken
                        setTimeout(resolveLoad, 2000);
                    }));
                } else {
                    // No img/iframe found (just a text placeholder), resolve immediately.
                    loadChecks.push(Promise.resolve());
                }
            });

            // Wait for all content to load or timeout
            return Promise.all(loadChecks).then(() => {
                // 1. First robust measurement attempt using double rAF (‡πÉ‡∏´‡πâ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÅ‡∏•‡∏∞‡∏ß‡∏≤‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô)
                requestAnimationFrame(() => {
                    requestAnimationFrame(alignProductImageHeights);
                });
                // 2. [FIX 2/2] - JS: ‡πÉ‡∏ä‡πâ setTimeout ‡πÄ‡∏õ‡πá‡∏ô Fallback ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡πÑ‡∏°‡πà‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ (200ms)
                setTimeout(alignProductImageHeights, 200);
            });
        }

        // --- VIEW MANAGEMENT ---

        function showView(viewName) {
            currentView = viewName;
            views.forEach(view => {
                document.getElementById(`view-${view}`).classList.add('hidden');
            });
            document.getElementById(`view-${viewName}`).classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });

            // Update Step Indicator
            updateStepIndicator(viewName);
        }

        // Keep the Step Indicator Highlight Fix
        function updateStepIndicator(viewName) {
            const stepsMap = {
                'products': 'step-1',
                'student-info': 'step-2',
                'summary-payment': 'step-3',
                'success': 'step-3' // Success is considered the final step (3)
            };
            const currentStepId = stepsMap[viewName];

            ['step-1', 'step-2', 'step-3'].forEach(stepId => {
                const stepEl = document.getElementById(stepId);
                const isCurrent = stepId === currentStepId;

                // 1. Reset all to default (non-highlighted) state
                stepEl.classList.add('opacity-50');
                stepEl.classList.remove('opacity-100');
                stepEl.querySelector('div').classList.remove('bg-red-600', 'text-white');
                stepEl.querySelector('div').classList.add('bg-gray-200', 'text-gray-500');
                stepEl.querySelector('span').classList.remove('text-red-600');
                stepEl.querySelector('span').classList.add('text-gray-500');


                // 2. Apply highlight to the current step
                if (isCurrent) {
                    stepEl.classList.remove('opacity-50');
                    stepEl.classList.add('opacity-100');
                    stepEl.querySelector('div').classList.remove('bg-gray-200', 'text-gray-500');
                    stepEl.querySelector('div').classList.add('bg-red-600', 'text-white');
                    stepEl.querySelector('span').classList.remove('text-gray-500');
                    stepEl.querySelector('span').classList.add('text-red-600');
                }
            });
        }

        // --- DATA FETCHING & INITIALIZATION ---

        async function fetchAppData() {
            toggleLoading(true);
            try {
                const response = await fetch(API_ENDPOINT_GET_DATA);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                appData = await response.json();

                // 1. Update Promo Info
                const unwantedText = appData.UNWANTED_PROMO_TEXT || "Powered by Flickr";
                document.getElementById('promo-image-embed').innerHTML = (appData.PROMOTION_IMAGE_EMBED_CODE || '<div></div>').replace(new RegExp(unwantedText.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&'), 'g'), '').trim();
                document.getElementById('promo-line-1').textContent = appData.PROMOTION_TEXT_LINE_1 || "‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©";
                document.getElementById('promo-line-2').textContent = appData.PROMOTION_TEXT_LINE_2 || "‡∏£‡∏±‡∏ö‡∏ü‡∏£‡∏µ! ‡∏ï‡∏∏‡πä‡∏Å‡∏ï‡∏≤‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏™‡∏≤‡∏ß‡∏ô‡πâ‡∏≠‡∏¢‡∏≠‡∏±‡∏™‡∏™‡∏±‡∏°‡∏ä‡∏±‡∏ç‡∏Ñ‡∏≠‡∏ô‡πÅ‡∏ß‡∏ô‡∏ï‡πå 1 ‡∏ä‡∏∏‡∏î";
                document.getElementById('promo-line-3').textContent = appData.PROMOTION_TEXT_LINE_3 || "‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Ñ‡∏£‡∏ö 350 ‡∏ö‡∏≤‡∏ó‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ ‡∏ï‡πà‡∏≠ 1 ‡∏£‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠";

                // 2. Update QR Code Embed Container
                const qrCodeEmbedContainer = document.getElementById('qr-code-embed-container');
                const qrCodeUrl = appData.QR_CODE_IMAGE_URL || '';
                if (qrCodeUrl.trim() !== '') {
                    // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡πÇ‡∏Ñ‡πâ‡∏î Embed ‡∏ó‡∏µ‡πà‡∏™‡∏∞‡∏≠‡∏≤‡∏î
                    const cleanQrEmbed = qrCodeUrl.replace(new RegExp(unwantedText.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&'), 'g'), '').trim();
                    qrCodeEmbedContainer.innerHTML = cleanQrEmbed;
                } else {
                    qrCodeEmbedContainer.innerHTML = `<p class="text-gray-400 text-sm">QR Code Placeholder</p>`;
                }

                // 3. Render Products
                renderProductList();
		        // Keep the Step Indicator Highlight Fix
                showView('products');
                
                // [FIX] ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ setMobilePadding ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤ Fixed Footer
                setMobilePadding(); 
                
            } catch (error) {
                console.error("Initialization Error - Fetch Failed:", error);
                console.error("Attempted URL:", API_ENDPOINT_GET_DATA);
                const errorMessage = `‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏î‡πâ (Error: ${error.message}). ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å: 1. **‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á (Permissions) ‡∏Ç‡∏≠‡∏á Google Apps Script Web App** ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô 'Anyone' ‡∏´‡∏£‡∏∑‡∏≠ 2. **URL ‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î**`;
                showMessageBox("‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•", errorMessage);
            } finally {
                toggleLoading(false);
            }
        }

        function renderProductList() {
            if (!appData || !appData.products) return;

            const productListContainer = document.getElementById('product-list');
            productListContainer.innerHTML = ''; // Clear previous list
            const unwantedText = appData.UNWANTED_PROMO_TEXT || "Powered by Flickr";

            appData.products.forEach(product => {
                if (product.id && product.name && product.price !== undefined) {
                    const cartItem = cart.find(item => item.id === product.id);
                    const quantity = cartItem ? cartItem.quantity : 0;
                    
                    const productDiv = document.createElement('div');
                    productDiv.className = 'bg-white rounded-xl shadow-lg overflow-hidden flex flex-col transition duration-300 hover:shadow-xl';
                    productDiv.innerHTML = `
                        <div class="product-img-box p-4 bg-gray-100 flex items-center justify-center">
                            <div class="product-image-container w-full h-full">
                                ${product.imageEmbedCode ? product.imageEmbedCode.replace(new RegExp(unwantedText.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&'), 'g'), '').trim() : `<p class="text-gray-400 text-sm">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</p>`}
                            </div>
                        </div>
                        <div class="p-4 flex flex-col flex-grow">
                            <h3 class="text-lg font-bold text-gray-800 mb-1">${product.name}</h3>
                            <p class="text-yellow-600 font-semibold text-xl mb-3">${formatPrice(product.price)} ‡∏ö‡∏≤‡∏ó</p>
                            ${product.description ? `<p class="text-sm text-gray-500 flex-grow mb-3">${product.description}</p>` : '<p class="text-sm text-gray-400 flex-grow mb-3">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>'}

                            <div class="flex items-center justify-between mt-auto">
                                <span class="text-sm text-gray-600">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô:</span>
                                <div class="flex items-center space-x-2">
                                    <button onclick="updateCartQuantity('${product.id}', -1)" ${quantity === 0 ? 'disabled' : ''} class="w-8 h-8 bg-red-500 text-white font-bold rounded-full hover:bg-red-600 disabled:opacity-50 disabled:cursor-not-allowed transition duration-150">
                                        -
                                    </button>
                                    <span class="w-8 text-center font-bold text-lg text-gray-800">${quantity}</span>
                                    <button onclick="updateCartQuantity('${product.id}', 1)" class="w-8 h-8 bg-green-500 text-white font-bold rounded-full hover:bg-green-600 transition duration-150">
                                        +
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    productListContainer.appendChild(productDiv);
                }
            });

            updateCartSummary();
            
            // Wait for all product images/embeds to load before aligning
            waitForProductContentLoad();
        }

        // --- CART LOGIC ---

        function updateCartQuantity(productId, delta) {
            const product = appData.products.find(p => p.id === productId);
            if (!product) return;

            const cartIndex = cart.findIndex(item => item.id === productId);

            if (cartIndex > -1) {
                // Item exists
                const newQuantity = cart[cartIndex].quantity + delta;
                if (newQuantity <= 0) {
                    cart.splice(cartIndex, 1); // Remove if quantity drops to 0 or less
                } else {
                    cart[cartIndex].quantity = newQuantity;
                }
            } else if (delta > 0) {
                // Item does not exist, and we are adding it
                cart.push({
                    id: product.id,
                    name: product.name,
                    price: product.price,
                    unit: product.unit || '',
                    quantity: delta
                });
            }

            // Re-render
            renderProductList();
        }

        function updateCartSummary() {
            const totalDisplay = document.getElementById('cart-total-display');
            const itemListContainer = document.getElementById('cart-item-list');
            const checkoutButton = document.getElementById('checkout-button');
            const promotionMessageEl = document.getElementById('cart-promotion-message');
            const toggleIcon = document.getElementById('cart-toggle-icon');
            let total = 0;
            let itemHtml = '';
            
            // 1. Generate item list HTML
            if (cart.length > 0) {
                cart.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    total += itemTotal;
                    itemHtml += `
                        <div class="flex justify-between items-center text-sm border-b border-gray-100 last:border-b-0 pb-1 pt-1">
                            <span class="text-gray-700 font-medium truncate">${item.name}</span>
                            <span class="text-gray-600 text-right ml-2 flex-shrink-0">${item.quantity} ‡∏ä‡∏¥‡πâ‡∏ô @ ${formatPrice(item.price)}</span>
                            <span class="text-yellow-600 font-semibold text-right ml-4 flex-shrink-0">${formatPrice(itemTotal)} ‡∏ö‡∏≤‡∏ó</span>
                        </div>
                    `;
                });
                itemListContainer.innerHTML = itemHtml;
                // Show list content for desktop and on mobile if explicitly toggled (managed by toggleCartList)
                if (window.innerWidth >= 768) {
                    itemListContainer.classList.remove('hidden');
                }
                toggleIcon.classList.remove('hidden'); // Show toggle icon
            } else {
                itemListContainer.innerHTML = '<div class="text-gray-500 text-sm italic text-center p-2">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤</div>';
                
                // Hide list content completely on mobile if cart is empty and the default is hidden
                if (window.innerWidth < 768) {
                    itemListContainer.classList.add('hidden');
                }
                toggleIcon.classList.add('hidden'); // Hide toggle icon
                
                total = 0;
            }

            // 2. Update Total and Button
            totalDisplay.textContent = `${formatPrice(total)} ‡∏ö‡∏≤‡∏ó`;

            // [FIX] ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ setMobilePadding ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏±‡∏ö Padding ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏£‡∏∏‡∏õ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï/‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
            setMobilePadding();

            if (total > 0) {
                checkoutButton.disabled = false;
                checkoutButton.textContent = `‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠ (${formatPrice(total)} ‡∏ö‡∏≤‡∏ó)`;
                checkoutButton.classList.remove('bg-gray-400', 'cursor-not-allowed');
                checkoutButton.classList.add('bg-yellow-500', 'hover:bg-yellow-600');
            } else {
                checkoutButton.disabled = true;
                checkoutButton.textContent = '‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠ (‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á)';
                checkoutButton.classList.remove('bg-yellow-500', 'hover:bg-yellow-600');
                checkoutButton.classList.add('bg-gray-400', 'cursor-not-allowed');
            }

            // 3. Update Promotion Message
            const promotionThreshold = parseFloat(appData?.PROMOTION_AMOUNT || 350);
            const promoLine = appData?.PROMOTION_TEXT_LINE_2 || "‡∏£‡∏±‡∏ö‡∏ü‡∏£‡∏µ! ‡∏ï‡∏∏‡πä‡∏Å‡∏ï‡∏≤‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏™‡∏≤‡∏ß‡∏ô‡πâ‡∏≠‡∏¢‡∏≠‡∏±‡∏™‡∏™‡∏±‡∏°‡∏ä‡∏±‡∏ç‡∏Ñ‡∏≠‡∏ô‡πÅ‡∏ß‡∏ô‡∏ï‡πå 1 ‡∏ä‡∏∏‡∏î";
            const promoLine3 = appData?.PROMOTION_TEXT_LINE_3 || `‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Ñ‡∏£‡∏ö ${formatPrice(promotionThreshold)} ‡∏ö‡∏≤‡∏ó‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ ‡∏ï‡πà‡∏≠ 1 ‡∏£‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠`;

            if (total >= promotionThreshold) {
                promotionMessageEl.innerHTML = `<p class="text-green-600 text-sm font-semibold p-2 bg-green-50 rounded-lg">‚úÖ ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô: ${promoLine}</p>`;
            } else if (total > 0) {
                const remaining = promotionThreshold - total;
                promotionMessageEl.innerHTML = `<p class="text-sm text-blue-600 font-semibold p-2 bg-blue-50 rounded-lg">üõí ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏µ‡∏Å ${formatPrice(remaining)} ‡∏ö‡∏≤‡∏ó ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô!</p>`;
            } else {
                promotionMessageEl.innerHTML = `<p class="text-sm text-gray-500 p-2 bg-gray-100 rounded-lg">${promoLine3}</p>`;
            }
        }

        // --- STUDENT INFO LOGIC ---

        function validateStudentInfo() {
            const form = document.getElementById('student-info-form');
            if (form.checkValidity()) {
                // All fields are valid, proceed to summary view
                showView('summary-payment');
                updateSummaryView();
            } else {
                // Trigger browser's native validation UI
                form.reportValidity();
            }
        }

        // --- SUMMARY & PAYMENT LOGIC ---

        function updateSummaryView() {
            const studentName = document.getElementById('studentName').value;
            const studentLevel = document.getElementById('studentLevel').value;
            const studentRoom = document.getElementById('studentRoom').value;
            const studentNumber = document.getElementById('studentNumber').value;
            const contactPhone = document.getElementById('contactPhone').value;
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const promotionThreshold = parseFloat(appData?.PROMOTION_AMOUNT || 350);
            const promoLine = appData?.PROMOTION_TEXT_LINE_2 || "‡∏£‡∏±‡∏ö‡∏ü‡∏£‡∏µ! ‡∏ï‡∏∏‡πä‡∏Å‡∏ï‡∏≤‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏™‡∏≤‡∏ß‡∏ô‡πâ‡∏≠‡∏¢‡∏≠‡∏±‡∏™‡∏™‡∏±‡∏°‡∏ä‡∏±‡∏ç‡∏Ñ‡∏≠‡∏ô‡πÅ‡∏ß‡∏ô‡∏ï‡πå 1 ‡∏ä‡∏∏‡∏î";

            const summaryPromotionMessageEl = document.getElementById('summary-promotion-message');
            summaryPromotionMessageEl.classList.add('hidden');
            if (total >= promotionThreshold) {
                summaryPromotionMessageEl.innerHTML = `‚úÖ ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô: ${promoLine}`;
                summaryPromotionMessageEl.classList.remove('hidden');
            } else {
                summaryPromotionMessageEl.innerHTML = '';
            }

            // 1. User Info Summary
            document.getElementById('summary-student-name').textContent = studentName;
            document.getElementById('summary-student-level-room-no').textContent = `${studentLevel}/${studentRoom} (‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ${studentNumber})`;
            document.getElementById('summary-contact-phone').textContent = contactPhone;

            // 2. Cart Summary
            const summaryList = document.getElementById('summary-cart-items');
            summaryList.innerHTML = '';
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                const itemEl = document.createElement('div');
                itemEl.className = 'flex justify-between items-center text-sm border-b pb-1 last:border-b-0 last:pb-0';
                itemEl.innerHTML = `
                    <span class="text-gray-700 w-1/2 font-medium">${item.name}</span>
                    <span class="text-gray-500 text-right w-1/4">${item.quantity} ‡∏ä‡∏¥‡πâ‡∏ô x ${formatPrice(item.price)} ${item.unit}</span>
                    <span class="text-gray-800 font-semibold text-right w-1/4">${formatPrice(itemTotal)} ‡∏ö‡∏≤‡∏ó</span>
                `;
                summaryList.appendChild(itemEl);
            });

            // 3. Grand Total and Payment Amount
            document.getElementById('summary-total-display').textContent = `${formatPrice(total)} ‡∏ö‡∏≤‡∏ó`;
            document.getElementById('payment-amount').textContent = formatPrice(total);

            // 4. File Upload Listener for Enabling Submit Button
            const submitButton = document.getElementById('submit-order-button');
            const fileInput = document.getElementById('payment-slip-file');
            
            // Initial check
            if (fileInput.files.length > 0) {
                submitButton.disabled = false;
                submitButton.classList.remove('bg-gray-400', 'cursor-not-allowed');
                submitButton.classList.add('bg-green-600', 'hover:bg-green-700');
            } else {
                submitButton.disabled = true;
                submitButton.classList.remove('bg-green-600', 'hover:bg-green-700');
                submitButton.classList.add('bg-gray-400', 'cursor-not-allowed');
            }

            // Listen for file changes
            fileInput.onchange = () => {
                if (fileInput.files.length > 0) {
                    submitButton.disabled = false;
                    submitButton.classList.remove('bg-gray-400', 'cursor-not-allowed');
                    submitButton.classList.add('bg-green-600', 'hover:bg-green-700');
                } else {
                    submitButton.disabled = true;
                    submitButton.classList.remove('bg-green-600', 'hover:bg-green-700');
                    submitButton.classList.add('bg-gray-400', 'cursor-not-allowed');
                }
            };
        }

        async function submitOrder() {
            const submitButton = document.getElementById('submit-order-button');
            const fileInput = document.getElementById('payment-slip-file');
            
            if (fileInput.files.length === 0) {
                showMessageBox("‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠");
                return;
            }

            submitButton.disabled = true;
            submitButton.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...';
            toggleLoading(true);

            try {
                const file = fileInput.files[0];
                let fileUrl = '';
                
                // 1. Upload Slip (Separate function for clarity)
                const slipUploadResponse = await uploadSlip(file);
                fileUrl = slipUploadResponse.fileUrl;

                // 2. Construct Payload
                const studentName = document.getElementById('studentName').value;
                const studentLevel = document.getElementById('studentLevel').value;
                const studentRoom = document.getElementById('studentRoom').value;
                const studentNumber = document.getElementById('studentNumber').value;
                const contactPhone = document.getElementById('contactPhone').value;
                
                const payload = {
                    studentName: studentName,
                    studentLevel: studentLevel,
                    studentRoom: studentRoom,
                    studentNumber: studentNumber,
                    contactPhone: contactPhone,
                    cart: cart,
                    slipUrl: fileUrl
                };

                // 3. Submit Order Data
                const response = await fetch(API_ENDPOINT_SUBMIT_ORDER, {
                    method: 'POST',
                    // ‡πÉ‡∏ä‡πâ text/plain ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤ CORS Preflight
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.message || "‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß");
                }

                // 4. Show Success View
                prepareSuccessView(result.transactionNo);
                showView('success');

            } catch (error) {
                console.error("Submission Error:", error);
                showMessageBox("‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", `‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ: ${error.message}`);
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = '‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ';
                toggleLoading(false);
            }
        }

        async function uploadSlip(file) {
            const formData = new FormData();
            formData.append('file', file);
            formData.append('filename', file.name);

            const response = await fetch(API_ENDPOINT_UPLOAD_SLIP, {
                method: 'POST',
                // Important: Do not set Content-Type header when using FormData, browser will set it with boundary
                body: formData
            });

            const result = await response.json();

            if (!result.success) {
                throw new Error(result.message || "‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
            }
            return { fileUrl: result.fileUrl };
        }
        
        function prepareSuccessView(transactionNo) {
            // Update success messages from config
            document.getElementById('success-line-1').textContent = appConfig.SUCCESS_MESSAGE_1 || "‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
            document.getElementById('success-line-2').textContent = appConfig.SUCCESS_MESSAGE_2 || "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏•‡∏∂‡∏Å ASCS";
            document.getElementById('success-line-3').textContent = appConfig.SUCCESS_MESSAGE_3 || "‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 1-2 ‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£";
            document.getElementById('success-transaction-no').textContent = `‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠: ${transactionNo}`;
        }

        function resetApp() {
            cart = [];
            document.getElementById('student-info-form').reset();
            // Clear the file input as well
            document.getElementById('payment-slip-file').value = ''; 
            fetchAppData(); // Re-fetch to ensure data is fresh, then render products
            showView('products');
        }


        // --- APPLICATION STARTUP ---
        document.addEventListener('DOMContentLoaded', () => {
            fetchAppData();
            // Attach event listener to window resize for mobile cart toggle logic (to handle orientation change)
            window.addEventListener('resize', updateCartSummary);

            // Attach event listener to window resize for image height equalization (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡∏°‡πà)
            window.addEventListener('resize', () => {
                // ‡∏ï‡πâ‡∏≠‡∏á‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ DOM ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÉ‡∏´‡∏°‡πà
                document.querySelectorAll('.product-img-box').forEach(el => el.style.height = 'auto');
                // ‡πÉ‡∏ä‡πâ setTimeout 50ms ‡πÄ‡∏õ‡πá‡∏ô Fallback ‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏°‡∏µ‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì 'auto' ‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà
                setTimeout(alignProductImageHeights, 50); 
            });
        });

    </script>
</body>
</html>