<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASCS Souvenir Shop | ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏•‡∏∂‡∏Å</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Custom styles and fonts */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
        }
        .container-app {
            max-width: 1200px;
            margin: auto;
            min-height: 100vh;
            padding: 1rem;
        }
        /* Custom scrollbar for cart item list */
        .cart-item-list { 
            max-height: 250px; 
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #facc15 #e5e7eb;
        }
        .cart-item-list::-webkit-scrollbar {
            width: 8px;
        }
        .cart-item-list::-webkit-scrollbar-thumb {
            background-color: #facc15;
            border-radius: 10px;
        }
        /* Style for number input controls */
        .number-input-control {
            appearance: none;
            -moz-appearance: textfield;
        }
        .number-input-control::-webkit-outer-spin-button,
        .number-input-control::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        /* Custom style to make embedded iframes (like Flickr's) responsive within their container */
        .product-image-container {
            width: 100%;
            /* ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÇ‡∏î‡∏¢ JavaScript ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡πÅ‡∏ñ‡∏ß */
            height: 100%; 
            /* Ensure the content inside fits and centers */
            display: flex;
            align-items: center;
            justify-content: center;
        }
        /* [FIX 1/2] - CSS: ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ container ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ï‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡πÑ‡∏î‡πâ */
        .product-img-box {
            height: auto; 
            min-height: 150px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏° min-height ‡πÄ‡∏õ‡πá‡∏ô Fallback ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÑ‡∏°‡πà‡πÇ‡∏´‡∏•‡∏î */
        }
        
        .product-image-container iframe {
            /* ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡πÉ‡∏´‡πâ iframe ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏†‡∏≤‡∏¢‡πÉ‡∏ô ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á container */
            max-width: 100% !important;
            max-height: 100% !important;
            /* ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡πÉ‡∏´‡πâ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏†‡∏≤‡∏¢‡πÉ‡∏ô iframe ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡πÇ‡∏î‡∏¢‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô */
            object-fit: contain; 
            
            /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà parent ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ max/min ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏î‡∏µ */
            width: 100%; 
            height: 100%; 

            border: none !important; /* Remove any default border */
        }
        /* Style to handle potential height/width attributes in embed code */
        .product-image-container iframe[width], 
        .product-image-container iframe[height] {
            width: 100% !important;
            height: 100% !important;
        }

	.empty-square-box {
    		width: 100%;         /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á */
    		height: 200px;        /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á */
    		/* border: 2px solid black;  ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏™‡πâ‡∏ô‡∏Ç‡∏≠‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á */
    		position: static;     /* (‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô) ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô flow ‡∏õ‡∏Å‡∏ï‡∏¥‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö */
    		box-sizing: border-box; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏ß‡∏° border ‡πÅ‡∏•‡∏∞ padding */
    	/* ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà background-color ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤ */
}
    </style>
</head>
<body class="bg-gray-50">

    <div id="loading-overlay" class="fixed inset-0 bg-white bg-opacity-80 flex items-center justify-center z-50 hidden">
        <div class="flex flex-col items-center">
            <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-yellow-500"></div>
            <p class="mt-4 text-gray-700 font-semibold">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
        </div>
    </div>

    <div id="message-box" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full">
            <h3 id="message-title" class="text-xl font-bold mb-3 text-red-600">‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</h3>
            <p id="message-text" class="text-gray-700"></p>
            <button onclick="hideMessageBox()" class="mt-5 w-full py-2 bg-yellow-500 text-white font-bold rounded-lg hover:bg-yellow-600 transition duration-150">‡∏ï‡∏Å‡∏•‡∏á</button>
        </div>
    </div>

    <div class="container-app">
        
        <header id="custom-app-header" class="mb-6 p-6 bg-red-700 text-white text-center shadow-lg">
            <h1 class="text-3xl font-bold">‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏•‡∏∂‡∏Å ASCS</h1>
            <p class="text-sm mt-1 opacity-90">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏•‡∏∂‡∏Å</p>
        </header>

        <main id="app-content">
            
            <div class="flex justify-center items-center py-4 bg-white rounded-xl shadow-lg mb-6">
                <div id="step-1" class="flex flex-col items-center mx-2 sm:mx-4 opacity-50">
                    <div class="w-8 h-8 sm:w-10 sm:h-10 rounded-full bg-gray-200 text-gray-500 flex items-center justify-center font-bold">1</div>
                    <span class="text-xs sm:text-sm mt-1 text-gray-500">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span>
                </div>
                <div class="w-8 sm:w-12 h-0.5 bg-gray-300"></div>
                <div id="step-2" class="flex flex-col items-center mx-2 sm:mx-4 opacity-50">
                    <div class="w-8 h-8 sm:w-10 sm:h-10 rounded-full bg-gray-200 text-gray-500 flex items-center justify-center font-bold">2</div>
                    <span class="text-xs sm:text-sm mt-1 text-gray-500">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                </div>
                <div class="w-8 sm:w-12 h-0.5 bg-gray-300"></div>
                <div id="step-3" class="flex flex-col items-center mx-2 sm:mx-4 opacity-50">
                    <div class="w-8 h-8 sm:w-10 sm:h-10 rounded-full bg-gray-200 text-gray-500 flex items-center justify-center font-bold">3</div>
                    <span class="text-xs sm:text-sm mt-1 text-gray-500">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</span>
                </div>
            </div>

            <header id="app-header" class="mb-6 p-4 bg-white rounded-xl shadow-lg flex flex-col md:flex-row items-center border-t-4 border-yellow-500">
                <div class="md:w-32 w-24 h-24 md:h-32 bg-gray-200 rounded-lg overflow-hidden flex-shrink-0 mb-4 md:mb-0 md:mr-6">
                    <div id="promo-image-embed" class="w-full h-full product-image-container p-1">
                        <div class="text-xs text-gray-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô...</div> 
                    </div>
                </div>
                <div class="flex-grow text-center md:text-left">
                    <p id="promo-line-1" class="text-yellow-600 font-bold text-lg"></p>
                    <p id="promo-line-2" class="text-gray-800 font-semibold md:text-2xl text-xl"></p>
                    <p id="promo-line-3" class="text-gray-600 text-sm"></p>
                </div>
            </header>

            <div id="view-products" class="view-stage">
                <h2 class="text-2xl font-bold text-gray-700 mb-4 border-b pb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏•‡∏∂‡∏Å</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="product-list">
                    </div>
		<!-- ‡πÄ‡∏ß‡πâ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà ‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
                <div class="empty-square-box"></div>
                
                <div class="fixed bottom-0 left-0 right-0 bg-white border-t-2 border-yellow-500 p-4 shadow-2xl z-20 md:relative md:mt-6 md:p-0 md:shadow-none md:border-t-0 md:bg-transparent md:border md:rounded-xl md:shadow-lg">
                    
                    <div id="cart-header" class="flex justify-between items-center mb-3 cursor-pointer md:cursor-default" onclick="toggleCartList()">
                        <h3 class="text-lg md:text-xl font-bold text-gray-800 flex items-center">
                            ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
                            <svg id="cart-toggle-icon" class="md:hidden ml-2 transition-transform transform w-5 h-5 text-gray-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                        </h3>
                    </div>

                    <div id="cart-item-list" class="hidden md:block border-t pt-3 mt-3 space-y-2 cart-item-list border-gray-100">
                        <div class="text-gray-500 text-sm italic text-center p-2">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤</div>
                    </div>
                    
                    <div id="cart-promotion-message" class="mt-2">
                        </div>

                    <div id="cart-summary-total" class="flex justify-between items-center font-bold text-lg md:text-xl text-gray-800 mt-4 pt-3 border-t">
                        <span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span>
                        <span id="cart-total-display">0.00 ‡∏ö‡∏≤‡∏ó</span>
                    </div>

                    <button id="checkout-button" onclick="showView('student-info')" disabled class="w-full py-3 bg-gray-400 text-white font-bold rounded-lg transition duration-150 mt-4 cursor-not-allowed">
                        ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠ (‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á)
                    </button>
                </div>
            </div>

            <div id="view-student-info" class="view-stage hidden p-6 bg-white rounded-xl shadow-lg">
                <h2 class="text-2xl font-bold text-gray-700 mb-6 border-b pb-2">2. ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
                <form id="student-info-form" onsubmit="event.preventDefault(); validateStudentInfo()">
                    
                    <div class="space-y-4 mb-8">
                        <div>
                            <label for="studentName" class="block text-sm font-medium text-gray-700">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô*</label>
                            <input type="text" id="studentName" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-yellow-500 focus:ring-yellow-500 p-3 border" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏î‡πá‡∏Å‡∏´‡∏ç‡∏¥‡∏á‡∏≠‡∏±‡∏™‡∏™‡∏±‡∏° ‡∏Ñ‡∏≠‡∏ô‡πÅ‡∏ß‡∏ô‡∏ï‡πå">
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="studentLevel" class="block text-sm font-medium text-gray-700">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô*</label>
                                <select id="studentLevel" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-yellow-500 focus:ring-yellow-500 p-3 border">
                                    <option value="" disabled selected>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</option>
                                    <option value="‡∏õ.1">‡∏õ.1</option>
                                    <option value="‡∏õ.2">‡∏õ.2</option>
                                    <option value="‡∏õ.3">‡∏õ.3</option>
                                    <option value="‡∏õ.4">‡∏õ.4</option>
                                    <option value="‡∏õ.5">‡∏õ.5</option>
                                    <option value="‡∏õ.6">‡∏õ.6</option>
                                </select>
                            </div>
                            <div>
                                <label for="contactPhone" class="block text-sm font-medium text-gray-700">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ*</label>
                                <input type="tel" id="contactPhone" required pattern="[0-9]{10}" title="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå 10 ‡∏´‡∏•‡∏±‡∏Å" class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-yellow-500 focus:ring-yellow-500 p-3 border" placeholder="‡πÄ‡∏ä‡πà‡∏ô 0812345678">
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">‡∏´‡πâ‡∏≠‡∏á*</label>
                                <div class="flex mt-1">
                                    <button type="button" onclick="changeNumber('studentRoom', -1)" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-l-lg hover:bg-gray-300 transition duration-150">-</button>
                                    <input type="number" id="studentRoom" required min="1" value="1" class="number-input-control block w-full text-center border-y border-gray-300 shadow-sm focus:border-yellow-500 focus:ring-yellow-500 p-2.5">
                                    <button type="button" onclick="changeNumber('studentRoom', 1)" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-r-lg hover:bg-gray-300 transition duration-150">+</button>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà*</label>
                                <div class="flex mt-1">
                                    <button type="button" onclick="changeNumber('studentNumber', -1)" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-l-lg hover:bg-gray-300 transition duration-150">-</button>
                                    <input type="number" id="studentNumber" required min="1" value="1" class="number-input-control block w-full text-center border-y border-gray-300 shadow-sm focus:border-yellow-500 focus:ring-yellow-500 p-2.5">
                                    <button type="button" onclick="changeNumber('studentNumber', 1)" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-r-lg hover:bg-gray-300 transition duration-150">+</button>
                                </div>
                            </div>
                        </div>

                    </div>

                    <div class="flex justify-between gap-4 mt-6">
                        <button type="button" onclick="showView('products')" class="w-1/2 py-3 border border-gray-300 text-gray-700 font-bold rounded-lg hover:bg-gray-100 transition duration-150">
                            ‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                        </button>
                        <button type="submit" class="w-1/2 py-3 bg-yellow-500 text-white font-bold rounded-lg hover:bg-yellow-600 transition duration-150">
                            ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô ‚Üí
                        </button>
                    </div>
                </form>
            </div>

            <div id="view-summary-payment" class="view-stage hidden p-6 bg-white rounded-xl shadow-lg">
                <h2 class="text-2xl font-bold text-gray-700 mb-6 border-b pb-2">3. ‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h2>
                
                <div class="bg-gray-50 p-4 rounded-lg mb-6 border border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-800 mb-2 border-b pb-1">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠:</h3>
                    <p class="text-sm text-gray-600"><strong>‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</strong> <span id="summary-student-name"></span></p>
                    <p class="text-sm text-gray-600"><strong>‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô/‡∏´‡πâ‡∏≠‡∏á/‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà:</strong> <span id="summary-student-level-room-no"></span></p>
                    <p class="text-sm text-gray-600"><strong>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå:</strong> <span id="summary-contact-phone"></span></p>
                </div>

                <div class="mb-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-2 border-b pb-1">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠:</h3>
                    <div id="summary-cart-items" class="space-y-2 cart-item-list p-2 border rounded-lg bg-white">
                        </div>
                </div>
                
                <div id="summary-promotion-message" class="mt-4">
                    </div>

                <div class="flex justify-between items-center font-extrabold text-xl md:text-2xl text-yellow-600 mb-6 p-3 bg-yellow-50 rounded-lg border-2 border-yellow-300">
                    <span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span>
                    <span id="summary-grand-total">0.00 ‡∏ö‡∏≤‡∏ó</span>
                </div>
                
                <div class="border-t pt-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô (‡∏™‡πÅ‡∏Å‡∏ô QR Code)</h3>
                    <div class="flex justify-center mb-6">
                        <div class="w-full max-w-xs p-3 border-4 border-gray-200 rounded-lg bg-white shadow-inner">
                            <div id="qr-code-embed-container" class="w-full h-auto min-h-[250px] flex items-center justify-center product-image-container">
                                <p class="text-gray-400 text-sm">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î QR Code...</p>
                            </div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="block text-base font-medium text-gray-700 mb-2">‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏™‡∏•‡∏¥‡∏õ (JPG, PNG ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)*</label>
                        <input type="file" id="slip-upload" accept="image/jpeg, image/png" required class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-yellow-50 file:text-yellow-700 hover:file:bg-yellow-100">
                        <p id="slip-error" class="text-red-500 text-sm mt-1 hidden">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏•‡∏¥‡∏õ (JPG ‡∏´‡∏£‡∏∑‡∏≠ PNG) ‡∏Å‡πà‡∏≠‡∏ô‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠</p>
                    </div>

                    <div class="flex justify-between gap-4 mt-8">
                        <button type="button" onclick="showView('student-info')" class="w-1/2 py-3 border border-gray-300 text-gray-700 font-bold rounded-lg hover:bg-gray-100 transition duration-150">
                            ‚Üê ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö
                        </button>
                        <button id="submit-order-button" onclick="submitOrder()" class="w-1/2 py-3 bg-green-600 text-white font-bold rounded-lg hover:bg-green-700 transition duration-150">
                            ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ
                        </button>
                    </div>
                </div>
            </div>

            <div id="view-success" class="view-stage hidden flex flex-col items-center justify-center p-8 bg-white rounded-xl shadow-2xl h-[50vh] text-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-green-500 mb-4" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                </svg>
                <h2 id="success-line-1" class="text-3xl font-bold text-gray-800 mb-2">‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</h2>
                <p id="success-line-2" class="text-xl text-gray-600 mb-1">‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏•‡∏∂‡∏Å ASCS</p>
                <p id="success-line-3" class="text-lg text-gray-500 mb-6">‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 1-2 ‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£</p>
                <p id="success-transaction-no" class="text-sm text-gray-400 mb-6"></p>

                <button onclick="resetApp()" class="py-3 px-8 bg-yellow-500 text-white font-bold rounded-lg hover:bg-yellow-600 transition duration-150">
                    ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÉ‡∏´‡∏°‡πà
                </button>
            </div>
            
        </main>
    </div>

    <script>
        // --- CONFIGURATION ---
        // *** ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î: ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô URL ‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô Web App URL ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£ Deploy Google Apps Script (‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ https://) ***
        const GAS_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyxUFe61-WkWcFpU6rMQBw8DjK-zKjntwAvHP6zXPU7j8nZYobXsI4mNXl0zoNspZVdbQ/exec"; 

        // --- GLOBAL STATE ---
        let appConfig = {};
        let allProducts = [];
        let cart = [];
        let currentView = 'products';
        const views = ['products', 'student-info', 'summary-payment', 'success'];
        const studentLevels = ['‡∏õ.1', '‡∏õ.2', '‡∏õ.3', '‡∏õ.4', '‡∏õ.5', '‡∏õ.6'];

        // --- UTILITY FUNCTIONS ---
        
        // Show/Hide Loading Overlay
        function toggleLoading(show) {
            document.getElementById('loading-overlay').classList.toggle('hidden', !show);
        }

        // Show Custom Message Box
        function showMessageBox(title, message) {
            document.getElementById('message-title').textContent = title;
            document.getElementById('message-text').textContent = message;
            document.getElementById('message-box').classList.remove('hidden');
        }

        // Hide Custom Message Box
        function hideMessageBox() {
            document.getElementById('message-box').classList.add('hidden');
        }

        // Price formatting helper
        function formatPrice(price) {
            return price.toLocaleString('th-TH', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        // Helper for file to Base64 conversion
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }
        
        // --- LAYOUT/HEIGHT MANAGEMENT (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡∏°‡πà) ---
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á Product Image Container ‡πÅ‡∏•‡∏∞‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏≠‡∏±‡∏ô
        function alignProductImageHeights() {
            const listContainer = document.getElementById('product-list');
            // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Container ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            const imageContainers = listContainer.querySelectorAll('.product-img-box'); 
            let maxHeight = 0;

            if (imageContainers.length === 0) return;
            
            // 1. Calculate Max Height
            imageContainers.forEach(container => {
                // container.offsetHeight ‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà Element ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å Render ‡πÅ‡∏•‡πâ‡∏ß
                const currentHeight = container.offsetHeight; 
                if (currentHeight > maxHeight) {
                    maxHeight = currentHeight;
                }
            });

            // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥‡πÑ‡∏ß‡πâ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
            if (maxHeight < 150) { 
                maxHeight = 300; 
            }
            
            // 2. Apply Max Height to all containers
            imageContainers.forEach(container => {
                // ‡πÉ‡∏ä‡πâ inline style ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á (‡∏°‡∏µ priority ‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤ CSS class)
                container.style.height = `${maxHeight}px`;
            });
        }

        // --- VIEW MANAGEMENT ---

        function showView(viewName) {
            currentView = viewName;
            views.forEach(view => {
                document.getElementById(`view-${view}`).classList.add('hidden');
            });
            document.getElementById(`view-${viewName}`).classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            // Update Step Indicator
            updateStepIndicator(viewName);
        }

        // Keep the Step Indicator Highlight Fix
	function updateStepIndicator(viewName) {
            const stepsMap = {
                'products': 'step-1',
                'student-info': 'step-2',
                'summary-payment': 'step-3',
                'success': 'step-3' // Success is considered the final step (3)
            };
            
            const currentStepId = stepsMap[viewName];

            ['step-1', 'step-2', 'step-3'].forEach(stepId => {
                const stepEl = document.getElementById(stepId);
                const isCurrent = stepId === currentStepId;

                // 1. Reset all to default (non-highlighted) state
                stepEl.classList.add('opacity-50');
                stepEl.classList.remove('opacity-100');
                
                stepEl.querySelector('div').classList.remove('bg-red-600', 'text-white');
                stepEl.querySelector('div').classList.add('bg-gray-200', 'text-gray-500');
                
                stepEl.querySelector('span').classList.remove('text-red-600');
                stepEl.querySelector('span').classList.add('text-gray-500');

                // 2. Apply highlight to the current step only
                if (isCurrent) {
                    stepEl.classList.add('opacity-100');
                    stepEl.classList.remove('opacity-50');
                    
                    stepEl.querySelector('div').classList.add('bg-red-600', 'text-white');
                    stepEl.querySelector('div').classList.remove('bg-gray-200', 'text-gray-500');
                    
                    stepEl.querySelector('span').classList.add('text-red-600');
                    stepEl.querySelector('span').classList.remove('text-gray-500');
                }
            });
        }
        
        // --- DATA FETCHING & INITIALIZATION ---

        async function fetchAppData() {
            // Check 1: Ensure the URL is set and looks like a valid URL (starts with https)
            if (GAS_WEB_APP_URL === "YOUR_GAS_WEB_APP_URL" || !GAS_WEB_APP_URL.startsWith('https')) {
                showMessageBox("‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤", "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç 'GAS_WEB_APP_URL' ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î JavaScript ‡∏î‡πâ‡∏ß‡∏¢ URL ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£ Deploy Apps Script ‡∏Å‡πà‡∏≠‡∏ô (‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ https://)");
                return;
            }

            toggleLoading(true);
            try {
                // Simplified fetch call for GET request to Google Apps Script
                const response = await fetch(GAS_WEB_APP_URL, {
                    method: 'GET',
                    cache: 'no-cache' // Prevent browser caching issues
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}. Response body: ${await response.text().catch(() => 'No body received.')}`);
                }

                const data = await response.json();

                if (data.success === false) {
                    throw new Error(data.message || "Unknown API error.");
                }

                appConfig = data.config || {};
                allProducts = data.products || [];
                
                // Placeholder for when the embed code is missing or invalid
                const unwantedText = "https://drive.google.com/uc?export=view&id="; // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° URL ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö

                // 1. Update Header (Config) - PROMOTION IMAGE
                const promoEmbedContainer = document.getElementById('promo-image-embed');
                const promoImageUrl = appConfig.PROMO_IMAGE_URL || '';
                
                if (promoImageUrl.trim() !== '') {
                    // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡πÇ‡∏Ñ‡πâ‡∏î Embed ‡∏ó‡∏µ‡πà‡∏™‡∏∞‡∏≠‡∏≤‡∏î
                    const cleanPromoEmbed = promoImageUrl.replace(new RegExp(unwantedText.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&'), 'g'), '').trim();
                    promoEmbedContainer.innerHTML = cleanPromoEmbed;
                } else {
                    // Fallback to a placeholder image if no URL is provided
                    promoEmbedContainer.innerHTML = `<img src="https://placehold.co/128x128/facc15/ffffff?text=ASCS" alt="Promotion Header" class="w-full h-full object-cover">`;
                }

                // Update Promotion Texts
                document.getElementById('promo-line-1').textContent = appConfig.PROMOTION_TEXT_LINE_1 || "üéÅ ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©!";
                document.getElementById('promo-line-2').textContent = appConfig.PROMOTION_TEXT_LINE_2 || "‡∏£‡∏±‡∏ö‡∏ü‡∏£‡∏µ! ‡∏ï‡∏∏‡πä‡∏Å‡∏ï‡∏≤‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏™‡∏≤‡∏ß‡∏ô‡πâ‡∏≠‡∏¢‡∏≠‡∏±‡∏™‡∏™‡∏±‡∏°‡∏ä‡∏±‡∏ç‡∏Ñ‡∏≠‡∏ô‡πÅ‡∏ß‡∏ô‡∏ï‡πå 1 ‡∏ä‡∏∏‡∏î";
                document.getElementById('promo-line-3').textContent = appConfig.PROMOTION_TEXT_LINE_3 || "‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Ñ‡∏£‡∏ö 350 ‡∏ö‡∏≤‡∏ó‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ ‡∏ï‡πà‡∏≠ 1 ‡∏£‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠";
                
                // 2. Update QR Code Embed Container
                const qrCodeEmbedContainer = document.getElementById('qr-code-embed-container');
                const qrCodeUrl = appConfig.QR_CODE_IMAGE_URL || '';
                
                if (qrCodeUrl.trim() !== '') {
                    // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡πÇ‡∏Ñ‡πâ‡∏î Embed ‡∏ó‡∏µ‡πà‡∏™‡∏∞‡∏≠‡∏≤‡∏î
                    const cleanQrEmbed = qrCodeUrl.replace(new RegExp(unwantedText.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&'), 'g'), '').trim();
                    qrCodeEmbedContainer.innerHTML = cleanQrEmbed;
                } else {
                    qrCodeEmbedContainer.innerHTML = `<p class="text-gray-400 text-sm">QR Code Placeholder</p>`;
                }


                // 3. Render Products
                renderProductList();

		        // Keep the Step Indicator Highlight Fix
                showView('products');
                
            } catch (error) {
                console.error("Initialization Error - Fetch Failed:", error);
                console.error("Attempted URL:", GAS_WEB_APP_URL); 
                
                const errorMessage = `‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏î‡πâ (Error: ${error.message}). ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ô‡∏µ‡πâ‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å:
                
                1. **‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á (Permissions) ‡∏Ç‡∏≠‡∏á Google Apps Script Web App**: ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô **"Anyone, even anonymous"**
                2. **URL ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á**: Web App URL ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏£‡∏∞‡∏ö‡∏∏‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á

                ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Deploy ‡πÉ‡∏ô Google Apps Script ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏£‡∏±‡∏ö`;

                showMessageBox("‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Fetch Failed)", errorMessage);
            } finally {
                toggleLoading(false);
            }
        }

        function renderProductList() {
            const listContainer = document.getElementById('product-list');
            listContainer.innerHTML = '';

            if (allProducts.length === 0) {
                listContainer.innerHTML = '<p class="text-gray-500 text-center col-span-full">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>';
                return;
            }
            
            const defaultPlaceholderHtml = `<div class="w-full h-full flex items-center justify-center text-gray-400 text-sm">‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÇ‡∏Ñ‡πâ‡∏î‡∏ù‡∏±‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</div>`;
            const unwantedText = "https://drive.google.com/uc?export=view&id=";

            allProducts.forEach(product => {
                const cartItem = cart.find(item => item.id === product.id);
                const quantity = cartItem ? cartItem.quantity : 0;
                
                let productImageUrl = product.imageUrl || '';

                const cleanImageUrl = productImageUrl.replace(new RegExp(unwantedText.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&'), 'g'), '').trim();
                
                const embedHtml = cleanImageUrl !== '' 
                                ? cleanImageUrl 
                                : defaultPlaceholderHtml;
                
                const card = document.createElement('div');
                card.className = 'bg-white rounded-xl shadow-md overflow-hidden border border-gray-100 flex flex-col transition duration-300 hover:shadow-lg';
                
                card.innerHTML = `
                    <div class="bg-gray-100 flex items-center justify-center overflow-hidden p-2">
                        <div id="img-container-${product.id}" class="w-full product-image-container product-img-box"> 
                            ${embedHtml}
                        </div>
                    </div>
                    <div class="p-4 flex-grow">
                        <h3 class="text-xl font-bold text-gray-800 mb-1">${product.name}</h3>
                        <p class="text-sm text-gray-500 mb-3">${product.detail}</p>
                        <div class="flex justify-between items-end mb-4">
                            <span class="text-2xl font-extrabold text-yellow-600">${formatPrice(product.price)} ${product.unit}</span>
                        </div>
                    </div>
                    <div class="p-4 bg-gray-50 border-t flex justify-between items-center">
                        <label class="text-sm font-semibold text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô:</label>
                        <div class="flex items-center space-x-2">
                            <button onclick="updateCartQuantity('${product.id}', -1)" ${quantity === 0 ? 'disabled' : ''} class="w-8 h-8 bg-red-100 text-red-600 font-bold rounded-full hover:bg-red-200 disabled:bg-gray-100 disabled:text-gray-400">-</button>
                            <span id="qty-${product.id}" class="w-8 text-center font-bold text-lg">${quantity}</span>
                            <button onclick="updateCartQuantity('${product.id}', 1)" class="w-8 h-8 bg-green-100 text-green-600 font-bold rounded-full hover:bg-green-200">+</button>
                        </div>
                    </div>
                `;
                listContainer.appendChild(card);
            });
            updateCartSummary();

            // *** START FIX: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å setTimeout ‡πÄ‡∏õ‡πá‡∏ô Promise.all ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏° Failsafe Timing ***
            if (allProducts.length > 0) {
                const productListEl = document.getElementById('product-list');
                const imageContainers = productListEl.querySelectorAll('.product-img-box');
                let loadChecks = [];

                imageContainers.forEach(container => {
                    // Search for img or iframe within the container
                    const content = container.querySelector('img, iframe');
                    if (content) {
                        // Create a promise that resolves when content loads or after a robust timeout
                        loadChecks.push(new Promise(resolve => {
                            let resolved = false; 
                            
                            const resolveLoad = () => {
                                if (!resolved) {
                                    resolved = true;
                                    resolve();
                                }
                            };
                            
                            // 1. Check if already loaded (for cached images/fast browsers)
                            if (content.complete || (content.readyState === 'complete')) {
                                resolveLoad();
                                return;
                            }
                            
                            // 2. Wait for load event
                            // ‡πÉ‡∏ä‡πâ addEventListener ‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ï‡∏£‡∏á‡πÜ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡∏°‡∏µ Listener ‡∏≠‡∏∑‡πà‡∏ô‡πÜ
                            content.addEventListener('load', resolveLoad, { once: true });
                            
                            // 3. Fallback: Add a generous timeout (e.g. 2000ms) for mobile in case onload never fires/iframe is broken
                            setTimeout(resolveLoad, 2000); 
                        }));
                    } else {
                        // No img/iframe found (just a text placeholder), resolve immediately.
                        loadChecks.push(Promise.resolve());
                    }
                });
                
                // Wait for all content to load or timeout
                Promise.all(loadChecks).then(() => {
                    // 1. First robust measurement attempt using double rAF (‡πÉ‡∏´‡πâ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÅ‡∏•‡∏∞‡∏ß‡∏≤‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô)
                    requestAnimationFrame(() => {
                        requestAnimationFrame(alignProductImageHeights);
                    });
                    
                    // 2. [FIX 2/2] - JS: ‡πÄ‡∏û‡∏¥‡πà‡∏° Failsafe Timeout 500ms ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Mobile Safari/Chrome ‡∏ó‡∏µ‡πà‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏î‡∏Ñ‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
                    setTimeout(() => {
                         alignProductImageHeights();
                    }, 500);
                });
            }
            // *** END FIX ***
        }

        // --- CART LOGIC ---

        function updateCartQuantity(productId, delta) {
            const product = allProducts.find(p => p.id === productId);
            if (!product) return;

            const existingItemIndex = cart.findIndex(item => item.id === productId);

            if (existingItemIndex !== -1) {
                const newQuantity = cart[existingItemIndex].quantity + delta;
                if (newQuantity <= 0) {
                    cart.splice(existingItemIndex, 1); // Remove item
                } else {
                    cart[existingItemIndex].quantity = newQuantity;
                }
            } else if (delta > 0) {
                cart.push({
                    id: product.id,
                    name: product.name,
                    price: product.price,
                    unit: product.unit,
                    quantity: 1
                });
            }

            // Re-render
            renderProductList();
        }

        function getCartTotal() {
            return cart.reduce((total, item) => total + (item.price * item.quantity), 0);
        }

        function updateCartSummary() {
            const total = getCartTotal();
            const totalDisplay = document.getElementById('cart-total-display');
            const checkoutButton = document.getElementById('checkout-button');
            const itemListContainer = document.getElementById('cart-item-list');
            const toggleIcon = document.getElementById('cart-toggle-icon');
            const promotionMessageEl = document.getElementById('cart-promotion-message'); 
            let itemHtml = '';

            // --- PROMOTION LOGIC (VIEW 1) ---
            const minSpending = parseFloat(appConfig.TOTAL_PROMOTION_SPENDING) || Infinity;
            const message = appConfig.PROMOTION_SPENDING_MESSAGE || "";

            if (total >= minSpending && message) {
                promotionMessageEl.innerHTML = `<div class="p-2 mt-2 bg-green-100 text-green-700 font-semibold rounded-lg text-sm text-center">üéâ ${message}</div>`;
            } else {
                promotionMessageEl.innerHTML = '';
            }
            // ---------------------------------

            // 1. Generate item list HTML
            if (cart.length > 0) {
                cart.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    itemHtml += `
                        <div class="flex justify-between items-center text-sm border-b border-gray-100 last:border-b-0 pb-1 pt-1">
                            <span class="text-gray-700 font-medium truncate">${item.name}</span>
                            <span class="text-gray-600 text-right ml-2 flex-shrink-0">${item.quantity} ‡∏ä‡∏¥‡πâ‡∏ô @ ${formatPrice(item.price)}</span>
                            <span class="text-yellow-600 font-semibold text-right ml-4 flex-shrink-0">${formatPrice(itemTotal)} ‡∏ö‡∏≤‡∏ó</span>
                        </div>
                    `;
                });
                itemListContainer.innerHTML = itemHtml;
                
                // Show list if cart has items (Desktop: always visible via CSS, Mobile: depends on toggle)
                itemListContainer.classList.remove('hidden'); 
                toggleIcon.classList.remove('hidden'); // Show toggle icon
            } else {
                itemListContainer.innerHTML = '<div class="text-gray-500 text-sm italic text-center p-2">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤</div>';
                
                // Hide list content completely on mobile if cart is empty
                if (window.innerWidth < 768) {
                    itemListContainer.classList.add('hidden');
                }
                toggleIcon.classList.add('hidden'); // Hide toggle icon
            }

            // 2. Update Total and Button
            totalDisplay.textContent = `${formatPrice(total)} ‡∏ö‡∏≤‡∏ó`;
            
            if (total > 0) {
                checkoutButton.disabled = false;
                checkoutButton.textContent = `‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠ (${formatPrice(total)} ‡∏ö‡∏≤‡∏ó)`;
                checkoutButton.classList.remove('bg-gray-400', 'cursor-not-allowed');
                checkoutButton.classList.add('bg-yellow-500', 'hover:bg-yellow-600');
            } else {
                checkoutButton.disabled = true;
                checkoutButton.textContent = '‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠ (‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á)';
                checkoutButton.classList.add('bg-gray-400', 'cursor-not-allowed');
                checkoutButton.classList.remove('bg-yellow-500', 'hover:bg-yellow-600');
            }
        }

        // New function to handle mobile toggle for the cart list
        function toggleCartList() {
            const itemList = document.getElementById('cart-item-list');
            const icon = document.getElementById('cart-toggle-icon');
            
            // Only toggle on mobile (width < 768px) and if cart is not empty
            if (window.innerWidth < 768 && cart.length > 0) {
                itemList.classList.toggle('hidden');
                if (itemList.classList.contains('hidden')) {
                    icon.classList.remove('rotate-180');
                } else {
                    icon.classList.add('rotate-180');
                }
            }
        }


        // --- STUDENT INFO LOGIC ---
        
        // + / - button logic for room/number
        function changeNumber(inputId, delta) {
            const input = document.getElementById(inputId);
            let value = parseInt(input.value) || 0;
            value += delta;
            if (value < 1) value = 1; 
            input.value = value;
        }

        function validateStudentInfo() {
            const form = document.getElementById('student-info-form');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            // All required fields are filled, proceed to summary
            prepareSummaryView();
            showView('summary-payment');
        }

        // --- SUMMARY & PAYMENT LOGIC ---

        function prepareSummaryView() {
            const studentName = document.getElementById('studentName').value;
            const studentLevel = document.getElementById('studentLevel').value;
            const studentRoom = document.getElementById('studentRoom').value;
            const studentNumber = document.getElementById('studentNumber').value;
            const contactPhone = document.getElementById('contactPhone').value;
            const grandTotal = getCartTotal();
            
            const summaryPromotionMessageEl = document.getElementById('summary-promotion-message'); 

            // --- PROMOTION LOGIC (VIEW 3) ---
            const minSpending = parseFloat(appConfig.TOTAL_PROMOTION_SPENDING) || Infinity;
            const message = appConfig.PROMOTION_SPENDING_MESSAGE || "";

            if (grandTotal >= minSpending && message) {
                summaryPromotionMessageEl.innerHTML = `<div class="p-3 mb-6 bg-green-100 text-green-700 font-bold rounded-lg text-center border border-green-300">üéâ ${message}</div>`;
            } else {
                summaryPromotionMessageEl.innerHTML = '';
            }
            // ---------------------------------


            // 1. User Info Summary
            document.getElementById('summary-student-name').textContent = studentName;
            document.getElementById('summary-student-level-room-no').textContent = `${studentLevel}/${studentRoom} (‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ${studentNumber})`;
            document.getElementById('summary-contact-phone').textContent = contactPhone;
            
            // 2. Cart Summary
            const summaryList = document.getElementById('summary-cart-items');
            summaryList.innerHTML = '';
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                const itemEl = document.createElement('div');
                itemEl.className = 'flex justify-between items-center text-sm border-b pb-1 last:border-b-0 last:pb-0';
                itemEl.innerHTML = `
                    <span class="text-gray-700 w-1/2 font-medium">${item.name}</span>
                    <span class="text-gray-500 text-right w-1/4">${item.quantity} ‡∏ä‡∏¥‡πâ‡∏ô x ${formatPrice(item.price)} ${item.unit}</span>
                    <span class="text-gray-800 font-semibold text-right w-1/4">${formatPrice(itemTotal)} ‡∏ö‡∏≤‡∏ó</span>
                `;
                summaryList.appendChild(itemEl);
            });
            
            // 3. Grand Total
            document.getElementById('summary-grand-total').textContent = `${formatPrice(grandTotal)} ‡∏ö‡∏≤‡∏ó`;
            
            // 4. Reset slip field and hide error
            document.getElementById('slip-upload').value = '';
            document.getElementById('slip-error').classList.add('hidden');
        }

        async function submitOrder() {
            const slipInput = document.getElementById('slip-upload');
            const slipErrorEl = document.getElementById('slip-error');
            
            // 1. Check for file presence
            if (!slipInput.files.length) {
                slipErrorEl.textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠';
                slipErrorEl.classList.remove('hidden');
                showMessageBox("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô", "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠");
                return;
            }
            
            const slipFile = slipInput.files[0];
            const fileName = slipFile.name;
            const mimeType = slipFile.type;

            // Define allowed extensions (case-insensitive)
            const allowedExtensions = /(\.jpg|\.jpeg|\.png)$/i;
            
            // Define allowed MIME types
            const allowedMimeTypes = ['image/jpeg', 'image/png'];

            let isValid = true;
            let errorMessage = '';

            // 2. Check 1: File Extension Check
            if (!allowedExtensions.exec(fileName)) {
                isValid = false;
                errorMessage = '‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• JPG, JPEG ‡∏´‡∏£‡∏∑‡∏≠ PNG ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô';
            } 
            
            // 3. Check 2: MIME Type Check (MIME type is a more reliable check for file content)
            if (isValid && !allowedMimeTypes.includes(mimeType)) {
                // This check catches files that were renamed but are not actually images
                isValid = false;
                errorMessage = '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (MIME Type: image/jpeg ‡∏´‡∏£‡∏∑‡∏≠ image/png) ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô';
            }


            if (!isValid) {
                slipErrorEl.textContent = errorMessage;
                slipErrorEl.classList.remove('hidden');
                showMessageBox("‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á", errorMessage);
                return;
            }

            // Validation passed: Hide error message and proceed
            slipErrorEl.classList.add('hidden');
            
            const submitButton = document.getElementById('submit-order-button');
            submitButton.disabled = true;
            submitButton.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...';
            toggleLoading(true);

            try {
                // 1. Convert slip to Base64
                const slipBase64 = await fileToBase64(slipFile);

                // 2. Prepare Order Data
                const orderDetails = {
                    studentName: document.getElementById('studentName').value,
                    studentLevel: document.getElementById('studentLevel').value,
                    studentRoom: document.getElementById('studentRoom').value,
                    studentNumber: document.getElementById('studentNumber').value,
                    contactPhone: document.getElementById('contactPhone').value,
                    cartItems: cart // Array of { id, name, price, unit, quantity }
                };

                const payload = {
                    slipBase64: slipBase64,
                    // Use the original file name with date/time prefix for uniqueness
                    slipFileName: `${orderDetails.studentName.replace(/\s/g, '_')}_${new Date().getTime()}_${fileName}`,
                    orderDetails: orderDetails
                };

                // 3. Send to GAS API (doPost)
                const response = await fetch(GAS_WEB_APP_URL, {
                    method: 'POST',
                    // ‡πÉ‡∏ä‡πâ text/plain ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤ CORS Preflight
		         headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    body: JSON.stringify(payload)
                });
                
                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.message || "‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß");
                }
                
                // 4. Show Success View
                prepareSuccessView(result.transactionNo);
                showView('success');
                
            } catch (error) {
                console.error("Submission Error:", error);
                showMessageBox("‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠", `‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏î‡πâ: ${error.message}`);
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = '‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ';
                toggleLoading(false);
            }
        }
        
        function prepareSuccessView(transactionNo) {
            // Update success messages from config
            document.getElementById('success-line-1').textContent = appConfig.SUCCESS_MESSAGE_1 || "‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
            document.getElementById('success-line-2').textContent = appConfig.SUCCESS_MESSAGE_2 || "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏•‡∏∂‡∏Å ASCS";
            document.getElementById('success-line-3').textContent = appConfig.SUCCESS_MESSAGE_3 || "‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 1-2 ‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£";
            document.getElementById('success-transaction-no').textContent = `‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠: ${transactionNo}`;
        }

        function resetApp() {
            cart = [];
            document.getElementById('student-info-form').reset();
            fetchAppData(); // Re-fetch to ensure data is fresh, then render products
            showView('products');
        }


        // --- APPLICATION STARTUP ---
        document.addEventListener('DOMContentLoaded', () => {
            fetchAppData();
            // Attach event listener to window resize for mobile cart toggle logic (to handle orientation change)
            window.addEventListener('resize', updateCartSummary);

            // Attach event listener to window resize for image height equalization (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡∏°‡πà)
            window.addEventListener('resize', () => {
                // ‡∏ï‡πâ‡∏≠‡∏á‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ DOM ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÉ‡∏´‡∏°‡πà
                document.querySelectorAll('.product-img-box').forEach(el => el.style.height = 'auto');
                // ‡πÉ‡∏ä‡πâ setTimeout 50ms ‡πÄ‡∏õ‡πá‡∏ô Fallback ‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏°‡∏µ‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì 'auto' ‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà
                setTimeout(alignProductImageHeights, 50); 
            });
        });

    </script>
</body>
</html>